{% extends "base.html" %}

{% block content %}
{# è¯¦æƒ…é¡µåˆ†äº«é“¾æ¥ï¼šç»Ÿä¸€ä½¿ç”¨ base_url æ‹¼æ¥ï¼Œä¿è¯å¸¦åŸŸå #}
{% set share_base_url = base_url if base_url else 'http://120.79.176.134:8000' %}
{% set share_url = share_base_url.rstrip('/') ~ '/events/' ~ event.id %}
{% set participants_text = (event.participants|length > 0) and ('- ' ~ event.participants|join('\\n- ')) or 'æš‚æ— ' %}
{% set share_text = 'ğŸ§— çº¦æ”€é‚€è¯·\\næ—¶é—´ï¼š' ~ event.start_text_weekday ~ '\\nåœ°ç‚¹ï¼š' ~ event.location ~ '\\nå‘èµ·äººï¼š' ~ (event.host_nickname or
event.nickname) ~ '\\nå·²æŠ¥åï¼š' ~ (event.participants|length) ~ ' äºº\\næŠ¥åæ˜µç§°ï¼š\\n' ~ participants_text ~ '\\né“¾æ¥ï¼š' ~ share_url
%}

<section class="hero">
  <h1 class="hero__title"><span class="hero__emoji" aria-hidden="true">ğŸ§—</span><span class="hero__title-text">çº¦æ”€é‚€è¯·</span></h1>
  <p class="hero__subtitle">å‘ç¾¤åˆ†äº«é“¾æ¥ï¼Œå¤§å®¶ç‚¹è¿›æ¥ç›´æ¥æŠ¥å</p>
</section>

{% if err %}
<div class="alert alert--error">
  <span class="alert__icon">âš ï¸</span>
  <span class="alert__text">{{ err }}</span>
</div>
{% endif %}

{% if msg %}
<div class="alert alert--success">
  <span class="alert__icon">âœ…</span>
  <span class="alert__text">{{ msg }}</span>
</div>
{% endif %}

<section class="events-grid">
  <article class="event-card {% if is_expired %}event-card--expired{% endif %}">
    <div class="event-card__header">
      <div class="event-card__time">{{ event.start_text_weekday }}</div>
      {% if is_expired %}
      <span class="event-card__status event-card__status--expired">å·²è¿‡æœŸ</span>
      {% else %}
      <span class="event-card__status event-card__status--active">è¿›è¡Œä¸­</span>
      {% endif %}
    </div>

    <div class="event-card__body">
      <div class="event-card__location">{{ event.location }}</div>
      <div class="event-card__host">
        å‘èµ·äººï¼š<strong>{{ event.host_nickname or event.nickname }}</strong>
      </div>
    </div>

    <div class="participants">
      <div class="participants__title">å·²æŠ¥å ({{ event.participants|length }}äºº)</div>

      {% if event.participants|length > 0 %}
      <div class="participants__list">
        {% for p in event.participants %}
        <span class="participant">{{ p }}</span>
        {% endfor %}
      </div>
      {% else %}
      <p class="participants__empty">æš‚æ— äººæŠ¥åï¼Œå¿«æ¥ç¬¬ä¸€ä¸ªï¼</p>
      {% endif %}

      <form method="post" action="/events/{{ event.id }}/join" class="participants__join">
        <input type="hidden" name="next" value="/events/{{ event.id }}" />
        <input class="input" name="nickname" placeholder="æˆ‘ä¹Ÿè¦å»ï¼ˆå¡«æ˜µç§°ï¼‰" {% if is_expired %}disabled{% else %}required{%
          endif %} />
        <button class="btn btn--primary btn--small" type="submit" {% if is_expired %}disabled{% endif %}>ğŸ™‹ èµ´çº¦</button>
        <a class="btn btn--ghost btn--small" href="/">ğŸ¦ å’•å’•å’•</a>
      </form>
      {% if is_expired %}
      <p class="participants__empty">æ´»åŠ¨å·²è¿‡æœŸï¼Œæ— æ³•æŠ¥åæˆ–å–æ¶ˆã€‚</p>
      {% endif %}
    </div>

    <div class="event-card__actions">
      <a class="btn btn--ghost btn--small" href="/">â¬…ï¸ è¿”å›åˆ—è¡¨</a>
      <button class="btn btn--ghost btn--small" type="button" data-invite-text="{{ share_text|e }}">ğŸ“£ é‚€è¯·</button>
    </div>
  </article>
</section>

{% endblock %}