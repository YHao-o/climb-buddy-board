{% extends "base.html" %}

{% block content %}
<section class="hero">
  <h1 class="hero__title"><span class="hero__emoji" aria-hidden="true">ğŸ’¡</span><span
      class="hero__title-text">å»ºè®¾å»ºè®®</span></h1>
  <p class="hero__subtitle">æŠŠä½ æƒ³è¦çš„åŠŸèƒ½/æ”¹è¿›ç‚¹å‘Šè¯‰æˆ‘ä»¬ï¼Œä¸€èµ·æŠŠç½‘ç«™åšå¾—æ›´å¥½</p>
</section>

<div class="info-badges">
  <span class="info-badge">
    <span class="info-badge__icon">ğŸ•¶ï¸</span>
    æ”¯æŒåŒ¿å/ç½²å
  </span>
  <span class="info-badge">
    <span class="info-badge__icon">ğŸ«¶</span>
    ä¸‹æ–¹å±•ç¤ºè´¡çŒ®è€…åå•
  </span>
</div>

{% if err %}
<div class="alert alert--error">
  <span class="alert__icon">âš ï¸</span>
  <span class="alert__text">{{ err }}</span>
</div>
{% endif %}

{% if msg %}
<div class="alert alert--success">
  <span class="alert__icon">âœ…</span>
  <span class="alert__text">{{ msg }}</span>
</div>
{% endif %}

<details class="collapse collapse--suggestions" open>
  <summary>
    <span>ğŸ“ æäº¤å»ºè®¾å»ºè®®</span>
    <span class="collapse__hint">ç‚¹å‡»æ”¶èµ·</span>
  </summary>
  <div class="collapse__body">
    <form method="post" action="/suggestions/new">
      <div class="suggest-form">
        <label class="field">
          <span class="field__label">å»ºè®®å†…å®¹</span>
          <textarea class="input" name="content" rows="5" maxlength="2000" required
            placeholder="æ¯”å¦‚ï¼šå¢åŠ æš—é»‘æ¨¡å¼ / å¢åŠ æŠ•ç¥¨åŠŸèƒ½ / é¡µé¢åŠ è½½æ…¢å¯ä»¥ä¼˜åŒ–â€¦"></textarea>
        </label>

        <div class="suggest-form__row">
          <label class="check">
            <input class="check__input" type="checkbox" name="anonymous" value="1" id="suggest-anon" />
            <span class="check__label">åŒ¿åæäº¤</span>
          </label>
          <span class="muted">åŒ¿åæ—¶ä¸ä¼šå±•ç¤ºæ˜µç§°å’Œå¤´åƒ</span>
        </div>

        <div class="suggest-form__grid">
          <label class="field">
            <span class="field__label">ç¾¤æ˜µç§°ï¼ˆç½²åå¿…å¡«ï¼‰</span>
            <input class="input" name="nickname" id="suggest-nickname" placeholder="ç¾¤æ˜µç§°" />
          </label>
        </div>

        <div class="suggest-form__actions">
          <button class="btn btn--primary" type="submit">ğŸ“® æäº¤</button>
          <a class="btn btn--secondary" href="/suggestions">æ¸…ç©º</a>
        </div>
      </div>
    </form>
  </div>
</details>

<section class="suggestions">
  <div class="contributors__header">
    <h2 class="contributors__title">ğŸ“Œ å»ºè®¾å»ºè®®</h2>
    <span class="contributors__count">{{ suggestions|length if suggestions else 0 }} æ¡</span>
  </div>

  {% if suggestions and suggestions|length > 0 %}
  <div class="suggestions__list">
    {% for s in suggestions %}
    <article class="suggestion {{ 'suggestion--done' if s.is_done else '' }}">
      <div class="suggestion__header">
        <div class="suggestion__meta">
          {% if s.is_anonymous %}
          <span class="badge">åŒ¿å</span>
          {% else %}
          <span class="badge badge--success">{{ s.nickname }}</span>
          {% endif %}
          <span class="muted">{{ s.created_at }}</span>
          {% if s.is_done %}
          <span class="badge badge--success">å·²å®Œæˆ</span>
          {% endif %}
        </div>
        <div class="suggestion__actions">
          <form method="post" action="/suggestions/{{ s.id }}/done" class="inline">
            <input type="hidden" name="is_done" value="{{ '0' if s.is_done else '1' }}" />
            <button class="btn btn--secondary btn--small" type="submit">
              {{ 'å–æ¶ˆå®Œæˆ' if s.is_done else 'æ ‡è®°å®Œæˆ' }}
            </button>
          </form>
          <form method="post" action="/suggestions/{{ s.id }}/delete" class="inline" data-confirm="ç¡®è®¤åˆ é™¤è¿™æ¡å»ºè®®ï¼Ÿ">
            <button class="btn btn--secondary btn--small" type="submit">åˆ é™¤</button>
          </form>
        </div>
      </div>
      <div class="suggestion__content">{{ s.content|e }}</div>
    </article>
    {% endfor %}
  </div>
  {% else %}
  <section class="empty-state">
    <div class="empty-state__icon">ğŸ§©</div>
    <h3 class="empty-state__title">è¿˜æ²¡æœ‰å»ºè®®</h3>
    <p class="empty-state__text">æäº¤ç¬¬ä¸€æ¡å»ºè®®ï¼Œå¸®åŠ©æˆ‘ä»¬ä¸€èµ·å®Œå–„ç½‘ç«™</p>
  </section>
  {% endif %}
</section>

<section class="contributors">
  <div class="contributors__header">
    <h2 class="contributors__title">ğŸŒŸ è´¡çŒ®è€…åå•</h2>
    <span class="contributors__count">{{ contributors|length }} äºº</span>
  </div>

  {% if contributors and contributors|length > 0 %}
  <div class="contributors__grid" aria-label="è´¡çŒ®è€…åˆ—è¡¨">
    {% for c in contributors %}
    <div class="contributor">
      <img class="avatar" src="/contribute/{{ c.avatar_filename|urlencode }}" alt="{{ c.nickname|e }}" loading="lazy" />
      <div class="contributor__meta">
        <div class="contributor__name">{{ c.nickname }}</div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <section class="empty-state">
    <div class="empty-state__icon">ğŸª¨</div>
    <h3 class="empty-state__title">æš‚æ—¶è¿˜æ²¡æœ‰è´¡çŒ®è€…</h3>
    <p class="empty-state__text">æ¥æäº¤ç¬¬ä¸€æ¡å»ºè®¾å»ºè®®ï¼Œç‚¹äº®åå•å§ï¼</p>
  </section>
  {% endif %}
</section>

<script>
  // åŒ¿åæäº¤ï¼šç¦ç”¨æ˜µç§°/å¤´åƒè¾“å…¥ï¼Œé¿å…è¯¯æ“ä½œ
  document.addEventListener('DOMContentLoaded', () => {
    const anon = document.getElementById('suggest-anon')
    const nick = document.getElementById('suggest-nickname')
    if (!anon || !nick) return
    const apply = () => {
      const on = !!anon.checked
      nick.disabled = on
      if (on) {
        nick.value = ''
      }
    }
    anon.addEventListener('change', apply)
    apply()
  })
</script>
{% endblock %}

